name: Haskell CI

on: 
  pull_request:
  push:

jobs:
  vm-job:
    runs-on: self-hosted

    services:
      redis:
        image: redis
#        ports:
#        - 6379/tcp
        options: --entrypoint "redis-server" redis redis.conf

    steps:
##      - uses: shogo82148/actions-setup-redis@v1
#        with:
#          redis-version: '5.x'
#          auto-start: "true"  
#      - run: redis-cli ping
      - uses: actions/checkout@v1
      - uses: cachix/install-nix-action@v6
      - uses: cachix/cachix-action@v3
        with:
          name: 573-ci
          signingKey: '${{ secrets.CACHIX_SIGNING_KEY }}'
